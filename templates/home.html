{% extends "layout.html" %}
{% block title %}ISP Monitor{% endblock %}
{% block content %}
<script>
  window.onload=function(){
    document.getElementById('speedtest_button').addEventListener('click', function() {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', '/ajax/runspeedtest', true);
      xhr.onload = function() {
        var result = JSON.parse(xhr.responseText);
        document.getElementById('speedtest_result').innerHTML = result;
      };
      xhr.send();
    });
    document.getElementById('test_button').addEventListener('click', function() {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', '/ajax/test', true);
      xhr.onload = function() {
        var result = JSON.parse(xhr.responseText);
        document.getElementById('test_result').innerHTML = result;
      };
      xhr.send();
    });
  }
  </script>
<div class="container">
  <div class="row">
    <button type="submit" name="test_button" id="test_button">Test</button>&nbsp;<div id="test_result">Test results</div>
  </div>
    <div class="row">
        <button type="submit" name="speedtest_button" id="speedtest_button">Speedtest Now</button>&nbsp;<div id="speedtest_result">Last speed test: Download={{ listLastSpeedTest[0] }}MB/s, Upload={{ listLastSpeedTest[1] }}MB/s</div>
    </div>
    <div class="row">
      <div class="col-sm">
        <div id='latencychart' class='chart'”></div>
      </div>
      <div class="col-sm">
        <div id='speedchart' class='chart'”></div>
      </div>
    </div>
    <div class="row">
      <div class="col-sm">
        <h4>Outages</h4>
        <ul class="list-group">
          {% if events %}
            {% for event in events %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                {{ event['offlinetimedate'] }}<a href="{{ url_for('event', eventid=event['filename']) }}">{{ event['id'] }}</a>
                <span class="badge bg-primary rounded-pill">{{ event['downtimeformatted'] }}</span>
            </li>
            {% endfor %}
          {% else %}
          <li class="list-group-item d-flex justify-content-between align-items-center">None</li>
          {% endif %}
        </ul>
    </div>
      <div class="col-sm">
        <h4>Logs</h4>
        <ul class="list-group">
          {% if logfiles %}
            {% for logfile in logfiles %}
            <li class="list-group-item d-flex"><a href="{{ url_for('log', logid=logfile) }}">{{ logfile }}</a></li>
            {% endfor %}
          {% else %}
          <li class="list-group-item d-flex justify-content-between align-items-center">None</li>
          {% endif %}
        </ul>
      </div>
    </div>
</div>
<script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
<script type='text/javascript'>
  var graphs = {{ graphJSON | safe }};
  var stgraphs = {{ stgraphJSON | safe }};
  Plotly.plot('latencychart',graphs,{});
  Plotly.plot('speedchart',stgraphs,{});
</script>
{% endblock %}